# Generated by Anaconda 34.25.0.29
# Generated by pykickstart v3.32
#version=RHEL9

# Keyboard layouts
keyboard --xlayouts='us'

# Root password
rootpw --plaintext ${linuxRootUser.password}

# System language
lang en_AU.UTF8

# Have we been provided a URL?
% if "http" in "${rhelBaseosBootUrlOrCdrom}".lower():
url --url ${rhelBaseosBootUrlOrCdrom}
% else:
# Otherwise, if we provid the full 4gb ISO, we can use CDROM installation media
cdrom
% endif

# Use text mode install
text

# SELinux configuration
selinux --permissive

# Disabled the Initial Setup application
firstboot --disable

# Do not configure the X Window System
skipx

# Network information
network  --bootproto=static --gateway=${dmsSubnet.gateway} --ip=${targetServer.ip} --nameserver=${dmsSubnet.dns1} --netmask=${dmsSubnet.netmask}

# Reboot after installation
reboot

# System timezone
timezone ${targetTimeZone} --utc

<%
sda = "%sda" % ksLinuxDiskFirstLetter
%>

# System bootloader configuration
bootloader --append="crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M" --location=mbr --boot-drive=${sda}

# Clear the Master Boot Record (If required)
zerombr 

# Clear the partitions
#clearpart --none --initlabel
clearpart --all --drives=${sda}

# Create the boot partition
part /boot --fstype xfs --size=${2*1024} --ondisk=${sda} --asprimary

# Allocate the rest to volume groups
part pv.${sda}pv --fstype="lvmpv" --size=1000   --grow  --ondisk=${sda}

# Create the ALL volume group
volgroup rootvg --pesize=4096 pv.${sda}pv

# Create the rootvg logical volumes
logvol /        --fstype="xfs"  --size=${20*1024}  --name=root --vgname=rootvg
logvol swap     --fstype="swap" --size=${8*1024}   --name=swap --vgname=rootvg
logvol /home    --fstype="xfs"  --size=${5*1024}   --name=home --vgname=rootvg

# Open MAKO raw text tag
<%text>

# RHEL8 Install the minimal packages.
%packages
@^server-product-environment
%end

# Install the certificate so we can pull pachages securely
%pre
cp /run/install/repo/cacerts/* /etc/pki/ca-trust/source/anchors/
update-ca-trust
%end

# Post installation Commands - fix root ssh login
%post
echo "PermitRootLogin yes" > /etc/ssh/sshd_config.d/01-permitrootlogin.conf
chmod 600 /etc/ssh/sshd_config.d/01-permitrootlogin.conf
%end

</%text>